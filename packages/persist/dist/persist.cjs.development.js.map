{"version":3,"file":"persist.cjs.development.js","sources":["../src/index.ts"],"sourcesContent":["import { Plugin, Models } from '@rematch/core'\nimport {\n\tpersistReducer,\n\tpersistStore,\n\tPersistConfig,\n\tPersistor,\n\tPersistorOptions,\n} from 'redux-persist'\nimport Redux from 'redux'\n\nlet persistor: Persistor\n// persistor is used for PersistGate\n// see https://github.com/rt2zz/redux-persist/blob/master/docs/PersistGate.md\nexport const getPersistor = (): Persistor => persistor\n\nexport type NestedPersist<M extends Models<M>> = {\n\t[modelKey in keyof M]?: PersistConfig<M[modelKey]['state']>\n}\n\n// rematch plugin\nconst persistPlugin = <\n\tS,\n\tTModels extends Models<TModels>,\n\tTExtraModels extends Models<TModels> = {}\n>(\n\tpersistConfig: PersistConfig<S>,\n\tnestedPersistConfig: NestedPersist<TModels> = {},\n\tpersistStoreConfig?: PersistorOptions,\n\tcallback?: () => void\n): Plugin<TModels, TExtraModels> => {\n\tif (!persistConfig) {\n\t\tthrow new Error('persist plugin is missing config object')\n\t}\n\n\treturn {\n\t\tonReducer(reducer: Redux.Reducer, modelName: string): void | Redux.Reducer {\n\t\t\tconst reducerConfig = nestedPersistConfig[modelName]\n\t\t\tif (reducerConfig) {\n\t\t\t\treturn persistReducer(reducerConfig, reducer)\n\t\t\t}\n\t\t\treturn undefined\n\t\t},\n\t\tonRootReducer(rootReducer: Redux.Reducer): Redux.Reducer {\n\t\t\treturn persistReducer(persistConfig, rootReducer)\n\t\t},\n\t\tonStoreCreated(store): void {\n\t\t\t// run persist store once store is available\n\t\t\tpersistor = persistStore(store, persistStoreConfig, callback)\n\t\t},\n\t}\n}\n\nexport default persistPlugin\n"],"names":["persistor","getPersistor","persistPlugin","persistConfig","nestedPersistConfig","persistStoreConfig","callback","Error","onReducer","reducer","modelName","reducerConfig","persistReducer","undefined","onRootReducer","rootReducer","onStoreCreated","store","persistStore"],"mappings":";;;;;;AAUA,IAAIA,SAAJ;IAGaC,YAAY,GAAG,SAAfA,YAAe;AAAA,SAAiBD,SAAjB;AAAA;;AAO5B,IAAME,aAAa,GAAG,SAAhBA,aAAgB,CAKrBC,aALqB,EAMrBC,mBANqB,EAOrBC,kBAPqB,EAQrBC,QARqB;MAMrBF;AAAAA,IAAAA,sBAA8C;;;AAI9C,MAAI,CAACD,aAAL,EAAoB;AACnB,UAAM,IAAII,KAAJ,CAAU,yCAAV,CAAN;AACA;;AAED,SAAO;AACNC,IAAAA,SADM,qBACIC,OADJ,EAC4BC,SAD5B;AAEL,UAAMC,aAAa,GAAGP,mBAAmB,CAACM,SAAD,CAAzC;;AACA,UAAIC,aAAJ,EAAmB;AAClB,eAAOC,2BAAc,CAACD,aAAD,EAAgBF,OAAhB,CAArB;AACA;;AACD,aAAOI,SAAP;AACA,KAPK;AAQNC,IAAAA,aARM,yBAQQC,WARR;AASL,aAAOH,2BAAc,CAACT,aAAD,EAAgBY,WAAhB,CAArB;AACA,KAVK;AAWNC,IAAAA,cAXM,0BAWSC,KAXT;AAaLjB,MAAAA,SAAS,GAAGkB,yBAAY,CAACD,KAAD,EAAQZ,kBAAR,EAA4BC,QAA5B,CAAxB;AACA;AAdK,GAAP;AAgBA,CA9BD;;;;;"}