{"version":3,"file":"persist.cjs.production.min.js","sources":["../src/index.ts"],"sourcesContent":["import { Plugin, Models } from '@rematch/core'\nimport {\n\tpersistReducer,\n\tpersistStore,\n\tPersistConfig,\n\tPersistor,\n\tPersistorOptions,\n} from 'redux-persist'\nimport Redux from 'redux'\n\nlet persistor: Persistor\n// persistor is used for PersistGate\n// see https://github.com/rt2zz/redux-persist/blob/master/docs/PersistGate.md\nexport const getPersistor = (): Persistor => persistor\n\nexport type NestedPersist<M extends Models<M>> = {\n\t[modelKey in keyof M]?: PersistConfig<M[modelKey]['state']>\n}\n\n// rematch plugin\nconst persistPlugin = <\n\tS,\n\tTModels extends Models<TModels>,\n\tTExtraModels extends Models<TModels> = {}\n>(\n\tpersistConfig: PersistConfig<S>,\n\tnestedPersistConfig: NestedPersist<TModels> = {},\n\tpersistStoreConfig?: PersistorOptions,\n\tcallback?: () => void\n): Plugin<TModels, TExtraModels> => {\n\tif (!persistConfig) {\n\t\tthrow new Error('persist plugin is missing config object')\n\t}\n\n\treturn {\n\t\tonReducer(reducer: Redux.Reducer, modelName: string): void | Redux.Reducer {\n\t\t\tconst reducerConfig = nestedPersistConfig[modelName]\n\t\t\tif (reducerConfig) {\n\t\t\t\treturn persistReducer(reducerConfig, reducer)\n\t\t\t}\n\t\t\treturn undefined\n\t\t},\n\t\tonRootReducer(rootReducer: Redux.Reducer): Redux.Reducer {\n\t\t\treturn persistReducer(persistConfig, rootReducer)\n\t\t},\n\t\tonStoreCreated(store): void {\n\t\t\t// run persist store once store is available\n\t\t\tpersistor = persistStore(store, persistStoreConfig, callback)\n\t\t},\n\t}\n}\n\nexport default persistPlugin\n"],"names":["persistor","persistConfig","nestedPersistConfig","persistStoreConfig","callback","Error","onReducer","reducer","modelName","reducerConfig","persistReducer","onRootReducer","rootReducer","onStoreCreated","store","persistStore"],"mappings":"wEAUIA,6CAUkB,SAKrBC,EACAC,EACAC,EACAC,eAFAF,IAAAA,EAA8C,KAIzCD,QACE,IAAII,MAAM,iDAGV,CACNC,mBAAUC,EAAwBC,OAC3BC,EAAgBP,EAAoBM,MACtCC,SACIC,iBAAeD,EAAeF,IAIvCI,uBAAcC,UACNF,iBAAeT,EAAeW,IAEtCC,wBAAeC,GAEdd,EAAYe,eAAaD,EAAOX,EAAoBC,2BAlC3B,kBAAiBJ"}